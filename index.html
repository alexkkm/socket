<!doctype html>
<html>
    <head>
        <!-- Import the socket.io -->
        <script src='/socket.io/socket.io.js'></script>
        <script>
            var socket = io();
            
            // Listen on the message from server with the title of 'welcome'
            socket.on('welcome', function(data) {
                createMessageElement(data.message);

                // Respond with emitting a message including this clients' id ,while this id is sent from the server
                socket.emit('joinned', {data: "New user has been joinned", id: data.id});
            });

            // When the server emit a message 'time', run createMessageElement function 
            socket.on('time', function(data) {
                //-- createMessageElement(data.time);
                editElement(data.time)
            });
            // Once receive 'error' message, console log the message
            socket.on('error', console.error.bind(console));
            // Once receive 'message' message, console log the message
            socket.on('message', console.log.bind(console));

            // Add the content into a new created html element 
            function createMessageElement(message) {
                var text = document.createTextNode(message),
                    element = document.createElement('p'),
                    messages = document.getElementById('messages');
                    element.appendChild(text);
                messages.appendChild(element);
            }

            // Edit the element content
            function editElement(message) {
                var text = document.createTextNode(message),
                    element = document.getElementById('time')
                element.innerHTML=message;
            }
        </script>
    </head>

    <body>
        <script>
            var input;
            // Update the "display" element with the content of the input "inputMessage"
            var editInput = ()=>{
                input = document.getElementById("inputMessage").value;
                //
                document.getElementById("display").innerHTML=input;
            }
            // Emit a message to the server with the content of "inputMessage"
            var submitMessage=()=>{
                content = document.getElementById("inputMessage").value;
                socket.emit('message',{data:content});
            }
        </script>

        <div id='messages'>
        </div>
        
        <p>Present Time: </p>
        <p id="time"></p>

        <input id="inputMessage" type="text" onchange="editInput()">
        <button id="submitButton" onclick="submitMessage()" >Submit Message</button>
        <p>Output: </p>
        <p id="display"></p>
    </body>
</html>